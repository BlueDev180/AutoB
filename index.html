<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no">
<title>Diag Test</title>
<style>
  html,body{margin:0;height:100%;background:#111;font-family:-apple-system,system-ui}
  canvas{display:block;width:100vw;height:100vh;touch-action:manipulation}
  #dbg{position:fixed;left:8px;bottom:8px;color:#9ee;font-size:12px;opacity:.9;pointer-events:none}
</style>
</head>
<body>
<canvas id="c"></canvas>
<div id="dbg">loadingâ€¦</div>
<script>
(function(){
  const dbg = document.getElementById('dbg');
  const canvas = document.getElementById('c');
  const ctx = canvas.getContext('2d', { alpha:false });

  // size for retina but draw in CSS pixels
  function resize(){
    const dpr = Math.max(1, devicePixelRatio||1);
    const w = innerWidth, h = innerHeight;
    canvas.width = Math.floor(w*dpr);
    canvas.height = Math.floor(h*dpr);
    canvas.style.width = w+'px';
    canvas.style.height = h+'px';
    ctx.setTransform(dpr,0,0,dpr,0,0);
  }
  addEventListener('resize', resize, {passive:true}); resize();

  // a test button in the center
  const btn = {w:180, h:80, x:0, y:0, on:false};
  function layout(){
    btn.x = Math.floor(innerWidth/2 - btn.w/2);
    btn.y = Math.floor(innerHeight/2 - btn.h/2);
  }
  addEventListener('resize', layout, {passive:true}); layout();

  function draw(){
    ctx.fillStyle = '#121214'; ctx.fillRect(0,0,innerWidth,innerHeight);
    ctx.fillStyle = '#eee';
    ctx.font = '24px -apple-system,system-ui';
    ctx.fillText('DIAGNOSTIC BUILD', 20, 40);
    ctx.font = '16px -apple-system,system-ui';
    ctx.fillText('Tap the box', 20, 68);

    ctx.fillStyle = btn.on ? '#4caf50' : '#7a50a0';
    ctx.fillRect(btn.x, btn.y, btn.w, btn.h);
    ctx.fillStyle = '#fff';
    ctx.font = '20px -apple-system,system-ui';
    ctx.fillText(btn.on?'ON':'OFF', btn.x+btn.w/2-18, btn.y+btn.h/2+7);
  }

  function pointIn(px,py,r){ return px>=r.x && py>=r.y && px<=r.x+r.w && py<=r.y+r.h; }
  function clientToCanvas(e){
    const rect = canvas.getBoundingClientRect();
    const t = (e.touches && e.touches[0]) ? e.touches[0] : e;
    return { x: t.clientX - rect.left, y: t.clientY - rect.top };
  }

  function handleTap(e){
    const p = clientToCanvas(e);
    if (pointIn(p.x,p.y,btn)) { btn.on = !btn.on; }
    dbg.textContent = `tap ${Math.round(p.x)},${Math.round(p.y)}  btn:${btn.on?'ON':'OFF'}`;
    draw();
    e.preventDefault();
  }

  canvas.addEventListener('pointerdown', handleTap, {passive:false});
  canvas.addEventListener('touchstart', handleTap, {passive:false});
  canvas.addEventListener('click', handleTap, {passive:true});

  draw();
  dbg.textContent = 'ready';
})();
</script>
</body>
</html>
